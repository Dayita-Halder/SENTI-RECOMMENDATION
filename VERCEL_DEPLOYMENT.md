# ğŸš€ Vercel Deployment Guide

## Overview

Your sentiment-based product recommender is now configured for **Vercel deployment** âœ¨

Vercel uses **serverless functions** (no traditional Flask server), making deployment:
- âœ… **Fast** - Deploy in seconds
- âœ… **Scalable** - Auto-scales to handle 1000s of concurrent users
- âœ… **Cheap** - Pay only for execution time (~$0.50 per 1M requests)
- âœ… **Global** - Content delivered from edge servers worldwide
- âœ… **Free tier available** - 100GB/month bandwidth, unlimited functions

---

## ğŸ“‹ Prerequisites

### 1. Install Vercel CLI (Windows)

```powershell
# Using npm (requires Node.js installed)
npm install -g vercel

# OR using choco (if Chocolatey installed)
choco install vercel
```

**No Node.js?** Download from https://nodejs.org/

### 2. GitHub Account (Free)

- Create account at https://github.com
- Vercel integrates seamlessly with GitHub
- Automatic deployments on push

### 3. Pickle Files Ready

Ensure these files exist in your project:
```
d:\sentiment recommendation\
â”œâ”€â”€ tfidf_vectorizer.pkl
â”œâ”€â”€ sentiment_model.pkl
â”œâ”€â”€ user_based_cf.pkl
â””â”€â”€ master_reviews.pkl
```

**Still missing?** Run the Jupyter notebook first.

---

## ğŸš€ Quick Start (5 Minutes)

### Step 1: Push Project to GitHub

```powershell
# Initialize git repo (if not already done)
cd d:\sentiment recommendation
git init

# Add files
git add .

# Commit
git commit -m "Initial commit - sentiment recommender"

# Create a new GitHub repo online at https://github.com/new
# Then push:
git remote add origin https://github.com/YOUR_USERNAME/sentiment-recommender.git
git branch -M main
git push -u origin main
```

### Step 2: Deploy to Vercel

**Option A: Via Web (Easiest)**

1. Go to https://vercel.com/new
2. Click "Import Git Repository"
3. Enter: `https://github.com/YOUR_USERNAME/sentiment-recommender`
4. Click "Import"
5. Review settings (defaults are fine)
6. Click "Deploy"
7. **Wait 2-3 minutes** â³

**Option B: Via CLI**

```powershell
vercel login
vercel --prod
```

### Step 3: Access Your App

After deployment completes:
- **URL:** https://sentiment-recommender.vercel.app (or your custom domain)
- **Open in browser** and test!

---

## ğŸ§ª Testing Your Deployment

### Web UI Test
```
1. Open https://YOUR_APP.vercel.app
2. Enter username & review
3. Click "Analyze"
4. See sentiment + recommendations
```

### API Test

**Sentiment Prediction:**
```bash
curl -X POST https://YOUR_APP.vercel.app/api/predict \
  -H "Content-Type: application/json" \
  -d '{"review_text":"This product is amazing!"}'
```

**Recommendations:**
```bash
curl -X POST https://YOUR_APP.vercel.app/api/recommend \
  -H "Content-Type: application/json" \
  -d '{"username":"alice_smith","n_recommendations":5}'
```

**Complete Pipeline:**
```bash
curl -X POST https://YOUR_APP.vercel.app/api/combined \
  -H "Content-Type: application/json" \
  -d '{"username":"alice_smith","review_text":"Great!","n_recommendations":5}'
```

**Health Check:**
```bash
curl https://YOUR_APP.vercel.app/api/health
```

---

## ğŸ“ Project Structure (Vercel Format)

```
sentiment-recommender/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.py                  â† Serverless function (entry point)
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html                â† Static UI
â”œâ”€â”€ model.py                       â† ML inference module
â”œâ”€â”€ vercel.json                    â† Vercel configuration
â”œâ”€â”€ requirements_vercel.txt        â† Python dependencies
â”œâ”€â”€ tfidf_vectorizer.pkl           â† Pre-trained (generated by notebook)
â”œâ”€â”€ sentiment_model.pkl            â† Pre-trained (generated by notebook)
â”œâ”€â”€ user_based_cf.pkl              â† Pre-trained (generated by notebook)
â”œâ”€â”€ master_reviews.pkl             â† Pre-trained (generated by notebook)
â”œâ”€â”€ .git/                          â† Git repository
â”œâ”€â”€ .gitignore                     â† Git ignore rules
â””â”€â”€ README.md
```

---

## ğŸ”§ How It Works

### Traditional Flask (Local)
```
Browser â†’ http://localhost:5000 â†’ Flask Server â†’ Model â†’ Response
```

### Vercel Serverless
```
Browser â†’ https://app.vercel.app â†’ API Function (api/index.py) â†’ Model â†’ Response
```

**Key Differences:**
- No Flask server running 24/7
- Functions spin up on-demand (~100ms cold start)
- Auto-scales to 1000s of concurrent requests
- Pay only when requests are served

---

## ğŸ”‘ Key Files Explained

### `api/index.py`
- **What:** Vercel serverless function
- **Purpose:** Routes ALL API requests to appropriate handlers
- **Handlers:**
  - `handle_predict()` â†’ `/api/predict`
  - `handle_recommend()` â†’ `/api/recommend`
  - `handle_combined()` â†’ `/api/combined`
  - `handle_health()` â†’ `/api/health`

### `vercel.json`
- **What:** Configuration file for Vercel
- **Defines:**
  - Build command: `pip install -r requirements_vercel.txt`
  - Routes: Maps URLs to functions/static files
  - Function timeouts & memory limits

### `public/index.html`
- **What:** Static HTML/CSS UI
- **Features:**
  - Responsive design (mobile-friendly)
  - Pure HTML/CSS (no frameworks)
  - Auto-detects API endpoint (works locally & on Vercel)
  - WebGL rendering not needed: Simple DOM

### `model.py`
- **What:** ML inference module
- **Contains:**
  - `SentimentRecommenderSystem` class
  - Model loading from pickles
  - Sentiment prediction logic
  - Recommendation generation

---

## ğŸŒ Custom Domain (Optional)

To use your own domain instead of `vercel.app`:

### Option 1: Domain Already at Another Registrar

1. Go to Vercel Project Settings â†’ Domains
2. Add custom domain (e.g., `sentimentapi.com`)
3. Update DNS records at your registrar:
   - Type `A` â†’ Points to Vercel nameservers
   - See Vercel instructions for exact values

### Option 2: Buy Domain Through Vercel

1. Vercel Dashboard â†’ Domains
2. Search & buy domain (2-3 years at wholesale)
3. Auto-configured with your app

---

## ğŸ“Š Performance & Limits

### Vercel Serverless limits
- **Max execution time:** 30 seconds (plenty for our model)
- **Memory:** 512 MB (our models use ~100 MB)
- **Cold start:** ~1 second (first request after idle)
- **Warm requests:** <100ms (subsequent requests)

### Recommended settings in `vercel.json`:
```json
{
  "functions": {
    "api/index.py": {
      "maxDuration": 30,      // Timeout in seconds
      "memory": 512           // Memory in MB
    }
  }
}
```

### Optimize if Needed:
```json
{
  "functions": {
    "api/index.py": {
      "maxDuration": 60,      // Increase to handle large batches
      "memory": 1024          // More memory for faster processing
    }
  }
}
```

---

## ğŸ” Security Best Practices

### 1. Environment Variables (Secrets)

For sensitive data (API keys, tokens):

```powershell
# Via Vercel CLI
vercel env add DATABASE_URL
vercel env add SECRET_KEY

# Then use in code:
import os
db_url = os.getenv('DATABASE_URL')
```

### 2. CORS Headers

Already configured in `api/index.py`:
```python
'Access-Control-Allow-Origin': '*'
```

Limit if needed:
```python
'Access-Control-Allow-Origin': 'https://trustedomain.com'
```

### 3. Rate Limiting

Add to `api/index.py` if using paid tier:
```python
from functools import wraps

request_count = {}

@ratelimit(max_calls=100, time_window=60)  # 100 requests per minute
def handle_combined(data):
    ...
```

---

## ğŸš¨ Troubleshooting

### Error: "Import Error: No module named 'model'"

**Cause:** `model.py` not in project root

**Solution:**
```
vercel-project/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.py
â”œâ”€â”€ model.py  â† Should be here
â”œâ”€â”€ vercel.json
```

---

### Error: "Module not found: 'pickle_file.pkl'"

**Cause:** Pickle files not committed to git

**Solution:**
```powershell
git add *.pkl
git commit -m "Add pickle files"
git push
vercel --prod
```

---

### Error: "Cold Start Timeout (504)"

**Cause:** Function takes >30s to initialize (imports are slow)

**Solution:** Increase timeout in `vercel.json`:
```json
{
  "functions": {
    "api/index.py": {
      "maxDuration": 60
    }
  }
}
```

---

### Error: "413 Payload Too Large"

**Cause:** Request body > 4.5 MB

**Solution:** Vercel shouldn't hit this. If it does:
```powershell
# Increase in vercel.json
{
  "env": {
    "MAX_REQUEST_SIZE": "10m"
  }
}
```

---

### Slow API Responses

**Cause 1: Cold start** (first request after idle)
- First request takes ~1-2 seconds
- Subsequent requests are <100ms
- Solutions:
  - Upgrade to Pro (better cold start)
  - Keep app "warm" with periodic pings

**Cause 2: Large dataset**
- Our pickle files are ~20 MB
- Loading can take 500-1000ms on first call
- Solution:
  - Cache pickles in memory (already done)
  - Use SSD storage Vercel provides

---

## ğŸ”„ Continuous Deployment (Auto-Deploy)

Once GitHub connected, Vercel auto-deploys on every push:

```powershell
# Make changes locally
echo "Update code" >> model.py

# Push to GitHub
git add .
git commit -m "Improve model"
git push origin main

# Vercel automatically triggers a new deployment!
# Check progress: https://vercel.com/dashboard
```

**To disable auto-deploy:**
- Vercel Dashboard â†’ Project Settings â†’ Git
- Toggle "Auto-Deploy" off

---

## ğŸ“ˆ Monitoring & Analytics

### View Analytics in Vercel Dashboard:
- **Overview:** Total requests, bandwidth used
- **Functions:** CPU time, memory usage, errors
- **Serverless Functions:** Real-time metrics per endpoint

### Custom Logging:

```python
# In api/index.py
import logging

logger = logging.getLogger(__name__)

try:
    result = system.predict_sentiment(review_text)
    logger.info(f"Prediction: {result['sentiment']}")
except Exception as e:
    logger.error(f"Prediction failed: {e}")
```

View logs in **Vercel Dashboard â†’ Monitoring â†’ Functions**

---

## ğŸ’° Pricing Comparison

| Platform | Startup | Scale | Cold Start | Notes |
|----------|---------|-------|-----------|-------|
| **Vercel (Free)** | $0 | 100GB BW/mo | ~1s | Best for learning |
| **Vercel (Pro)** | $20/mo | Unlimited BW | ~200ms | Production-ready |
| **Heroku** | $5/mo | Auto-scales | <100ms | Easy but limited |
| **AWS Lambda** | $0.20/mo | Massive | ~500ms | Complex setup |
| **Render** | $0 | 100GB BW/mo | ~1s | Good free tier |

**Recommendation:** Start with Vercel Free, upgrade to Pro ($20/mo) when you need faster cold starts.

---

## ğŸ› ï¸ Maintenance & Updates

### Update Dependencies

```powershell
# Update requirements_vercel.txt
pip list --outdated
pip install --upgrade scikit-learn numpy pandas nltk

# Update in requirements_vercel.txt, then push
git add requirements_vercel.txt
git commit -m "Update dependencies"
git push

# Vercel auto-redeploys with new packages
```

### Retrain Model Quarterly

```powershell
# Run notebook with new data
python sentiment_recommendation_notebook.ipynb

# Update pickle files
git add *.pkl
git commit -m "Retrain models with new data"
git push

# Vercel uses updated models automatically
```

---

## ğŸ“ Support & Resources

### Vercel Documentation
- https://vercel.com/docs/concepts/functions/serverless-functions
- https://vercel.com/docs/concepts/functions/serverless-functions/python

### GitHub Issues
- https://github.com/vercel/vercel/issues

### Community Help
- Vercel Discord: https://vercel.com/support
- Stack Overflow: `vercel` + `python` tags

---

## âœ… Deployment Checklist

- [ ] GitHub account created
- [ ] Project pushed to GitHub (`YOUR_USERNAME/sentiment-recommender`)
- [ ] Pickle files committed to git
- [ ] `vercel.json` configured
- [ ] `api/index.py` in project root
- [ ] `public/index.html` configured
- [ ] `requirements_vercel.txt` ready
- [ ] Vercel CLI installed (`npm install -g vercel`)
- [ ] Run `vercel --prod` to deploy
- [ ] Test at `https://YOUR_APP.vercel.app`
- [ ] (Optional) Set up custom domain
- [ ] (Optional) Configure environment variables

---

## ğŸ‰ You're Deployed!

Your sentiment-based product recommender is now **live on Vercel**, accessible globally.

**Your App URL:** https://YOUR_APP.vercel.app

### Next Steps:
1. **Share with others** - Your mom, friends, colleagues
2. **Monitor performance** - Check Vercel Dashboard daily
3. **Collect feedback** - Use real user data to improve
4. **Iterate** - Update models quarterly

**Congratulations! ğŸš€**

---

**Questions?** Check [DEPLOYMENT.md](DEPLOYMENT.md) for local setup or reach out to Vercel support.
